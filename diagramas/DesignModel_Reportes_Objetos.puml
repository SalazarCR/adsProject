@startuml DesignModel_Reportes_DiagramaObjetos
' Diagrama de Objetos de Diseño - Módulo Gestión de Reportes
' Análisis riguroso del código - Patrón MVC
' Arquitectura de 3 capas: Boundary → Controller → Entity

skinparam linetype ortho
skinparam classAttributeIconSize 0

' ==========================================
' ACTOR
' ==========================================
class "analista\n(from Actors)" as actorAnalista <<actor>>

' ==========================================
' CAPA DE PRESENTACIÓN (BOUNDARY)
' ==========================================
class "formulario\n(from shared)" as formulario <<boundary>> {
    {protected} cabeceraShow() : void
    {protected} menuShow() : void
    {protected} piePaginaShow() : void
}

class "formReportes" as formReportes <<boundary>> {
    +formListarReportesShow($movimientos : array, $kardex : array) : void
    +formReporteEntradaShow($entradas : array, $fechaInicio : string, $fechaFin : string, $pagina : int, $totalPaginas : int, $totalRegistros : int, $buscar : string) : void
    +formReporteSalidaShow($salidas : array, $fechaInicio : string, $fechaFin : string, $pagina : int, $totalPaginas : int, $totalRegistros : int, $buscar : string) : void
    {private} formatearFecha($fecha : string) : string
    {private} formatearFechaHora($fechaHora : string) : string
}

class "pantallaMensajeSistema\n(from shared)" as msgSistema <<boundary>> {
    +mensajeSistemaShow($tipo : int, $mensaje : string, $enlace : string) : void
}

' ==========================================
' CAPA DE CONTROL (CONTROLLER)
' ==========================================
class "getReportes" as getReportes <<controller>> {
    {function} validarBoton($nombreBoton : string) : bool
}

class "reporteController" as ctrlReporte <<controller>> {
    +__construct() : void
    +gestionar($buscar : string) : void
    +mostrarEntrada($fechaInicio : string, $fechaFin : string, $pagina : int, $buscar : string) : void
    +mostrarSalida($fechaInicio : string, $fechaFin : string, $pagina : int, $buscar : string) : void
}

' ==========================================
' CAPA DE ACCESO A DATOS (ENTITY)
' ==========================================
class "conexion\n(from config)" as conexion <<entity>> {
    {protected} $db : PDO
    +conectar() : void
    +desconectar() : void
}

class "movimiento\n(from core)" as movimiento <<entity>> {
    +obtenerTodos() : array
    +obtenerFiltrados($buscar : string) : array
    +obtenerKardex($producto_id : int, $fechaInicio : string, $fechaFin : string) : array
    +obtenerPorTipo($tipo : string, $fechaInicio : string, $fechaFin : string) : array
    +obtenerPorTipoPaginado($tipo : string, $fechaInicio : string, $fechaFin : string, $pagina : int, $porPagina : int) : array
    +contarPorTipo($tipo : string, $fechaInicio : string, $fechaFin : string) : int
    +obtenerFiltradosReporte($buscar : string) : array
    +obtenerPorTipoOrdenado($tipo : string, $orden : string, $buscar : string) : array
    +registrar($lote_id : int, $tipo : string, $cantidad : int, $motivo : string, $usuario_id : int) : bool
}

class "session\n(from core)" as session <<entity>> {
    {static} start() : void
    {static} set($key : string, $value : mixed) : void
    {static} get($key : string) : mixed
    {static} exists($key : string) : bool
    {static} remove($key : string) : void
    {static} destroy() : void
    {static} verificarSesion() : void
    {static} rol() : string
    {static} esAdmin() : bool
    {static} esAuxiliar() : bool
    {static} esAnalista() : bool
}

' ==========================================
' RELACIONES - ORDEN: BOUNDARY → CONTROLLER → MODEL
' ==========================================

' Actor accede al sistema
actorAnalista -> getReportes

' Herencia de formulario
formulario <|-- formReportes
formulario <|-- msgSistema

' Flujo de datos: Boundary → Controller
formReportes --> getReportes : POST/GET
getReportes --> formReportes

' Controller orquesta el flujo
getReportes --> ctrlReporte
ctrlReporte --> msgSistema
ctrlReporte --> formReportes

' Controller utiliza Entity
ctrlReporte --> movimiento

' Entity hereda de Conexion
conexion <|-- movimiento

' Controller verifica sesión
ctrlReporte --> session

@enduml
